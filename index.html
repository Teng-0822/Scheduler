<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4a90e2">
    <title>Virtual Assistant Scheduler</title>
    <style>
        :root {
            --primary: #4a90e2;
            --primary-dark: #357abd;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --text: #333;
            --text-light: #666;
            --border: #e9ecef;
            --bg: #f8f9fa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: var(--text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        header h1 { font-size: clamp(1.5rem, 4vw, 2rem); margin-bottom: 5px; }
        header p { font-size: clamp(0.85rem, 2vw, 1rem); opacity: 0.9; }

        .profile { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 50px; cursor: pointer; }
        .avatar { width: 35px; height: 35px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; font-size: 1.2em; color: var(--primary); }

        .tabs { display: flex; background: var(--bg); border-bottom: 2px solid var(--border); overflow-x: auto; }
        .tab-btn { flex: 1; min-width: 100px; padding: 15px; background: none; border: none; font-size: 1rem; font-weight: 600; color: var(--text-light); cursor: pointer; border-bottom: 3px solid transparent; }
        .tab-btn:hover { background: #e9ecef; color: var(--primary); }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); background: white; }

        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }

        .client-filter { background: var(--bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; }
        .client-pills { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .pill { padding: 8px 16px; border-radius: 20px; border: 2px solid var(--border); background: white; cursor: pointer; font-weight: 600; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        .pill:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .pill.active { background: var(--primary); color: white; border-color: var(--primary); }
        .pill .dot { width: 12px; height: 12px; border-radius: 50%; }

        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .calendar-header h2 { font-size: clamp(1.3rem, 3vw, 1.8rem); color: var(--primary); }
        .calendar-nav { display: flex; gap: 8px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-secondary { background: #95a5a6; color: white; }

        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 20px; }
        .cal-header { text-align: center; font-weight: 700; padding: 10px; background: var(--bg); border-radius: 8px; font-size: 0.9rem; }
        .cal-day { aspect-ratio: 1; border: 2px solid var(--border); border-radius: 12px; padding: 8px; cursor: pointer; background: white; position: relative; display: flex; flex-direction: column; align-items: center; min-height: 60px; }
        .cal-day:hover { border-color: var(--primary); transform: translateY(-4px); box-shadow: 0 6px 20px rgba(74,144,226,0.3); }
        .cal-day.other { opacity: 0.3; background: var(--bg); }
        .cal-day.today { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; font-weight: 700; }
        .cal-day.has-tasks::after { content: ''; position: absolute; bottom: 6px; width: 6px; height: 6px; background: var(--danger); border-radius: 50%; }
        .cal-day.today.has-tasks::after { background: white; }
        .day-num { font-size: 1.1rem; font-weight: 600; margin-bottom: 3px; }
        .day-count { font-size: 0.7rem; opacity: 0.8; }
        .day-dots { display: flex; gap: 3px; margin-top: 2px; }
        .day-dots .dot { width: 5px; height: 5px; border-radius: 50%; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; padding: 20px; overflow-y: auto; }
        .modal.active { display: flex; justify-content: center; align-items: flex-start; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; max-width: 600px; width: 100%; margin: 20px auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border); }
        .modal-header h3 { font-size: 1.5rem; color: var(--primary); }
        .close-btn { background: none; border: none; font-size: 2em; color: #999; cursor: pointer; }
        .close-btn:hover { color: var(--danger); }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--primary); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .task-list { display: flex; flex-direction: column; gap: 12px; }
        .task-item { background: var(--bg); padding: 15px; border-radius: 12px; border-left: 5px solid; }
        .task-item.urgency-low { border-left-color: var(--success); }
        .task-item.urgency-medium { border-left-color: var(--warning); }
        .task-item.urgency-high { border-left-color: #e67e22; }
        .task-item.urgency-urgent { border-left-color: var(--danger); }
        .task-header { display: flex; justify-content: space-between; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; }
        .task-title { font-size: 1.2rem; font-weight: 700; flex: 1; }
        .task-badges { display: flex; gap: 8px; }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 700; text-transform: uppercase; color: white; }
        .task-meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.85rem; color: var(--text-light); margin: 10px 0; }
        .task-actions { display: flex; gap: 8px; margin-top: 10px; }

        .client-item { background: var(--bg); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .client-info { display: flex; align-items: center; gap: 12px; flex: 1; }
        .client-box { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.2em; color: white; font-weight: bold; }

        .welcome-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; }
        .welcome-modal.active { display: flex; justify-content: center; align-items: center; padding: 20px; }
        .welcome-content { background: white; padding: 40px; border-radius: 20px; max-width: 500px; text-align: center; }
        .welcome-content h2 { color: var(--primary); font-size: 2rem; margin-bottom: 20px; }
        .welcome-btns { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
        .welcome-btn { padding: 18px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; }
        .welcome-btn.primary { background: var(--primary); color: white; }
        .welcome-btn.secondary { background: white; color: var(--primary); border: 3px solid var(--primary); }

        .empty-state { text-align: center; padding: 40px; color: #999; }
        .empty-state-icon { font-size: 3rem; margin-bottom: 15px; }

        @media (max-width: 768px) {
            .calendar { gap: 5px; }
            .cal-day { padding: 5px; min-height: 50px; font-size: 0.9rem; }
            .form-row { grid-template-columns: 1fr; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div id="welcomeModal" class="welcome-modal">
        <div class="welcome-content">
            <h2>üëã Welcome!</h2>
            <p>Choose how you'd like to use this app:</p>
            <div class="welcome-btns">
                <button class="welcome-btn primary" onclick="chooseMode('personal')">üë§ Personal Use<br><small>Set up your profile</small></button>
                <button class="welcome-btn secondary" onclick="chooseMode('guest')">üö∂ Guest Mode<br><small>Start immediately</small></button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1>üìÖ Virtual Assistant Scheduler</h1>
                    <p>Manage tasks by client</p>
                </div>
                <div class="profile" onclick="openTab('profile')">
                    <div class="avatar" id="avatar">üë§</div>
                    <span id="userName">Guest</span>
                </div>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="calendar">üìÖ Calendar</button>
            <button class="tab-btn" data-tab="tasks">üìã Tasks</button>
            <button class="tab-btn" data-tab="clients">üë• Clients</button>
            <button class="tab-btn" data-tab="profile">üë§ Profile</button>
        </div>

        <div id="calendar" class="tab-content active">
            <div class="client-filter">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <h4>üéØ Filter by Client</h4>
                    <button class="btn btn-secondary" style="padding: 5px 15px; font-size: 0.85rem;" onclick="toggleAllClients()"><span id="toggleText">Hide All</span></button>
                </div>
                <div class="client-pills" id="clientPills"></div>
            </div>

            <div class="calendar-header">
                <h2 id="monthYear"></h2>
                <div class="calendar-nav">
                    <button class="btn btn-primary" onclick="changeMonth(-1)">‚Üê Prev</button>
                    <button class="btn btn-primary" onclick="changeMonth(0)">Today</button>
                    <button class="btn btn-primary" onclick="changeMonth(1)">Next ‚Üí</button>
                </div>
            </div>

            <div class="calendar" id="calendarGrid"></div>
        </div>

        <div id="tasks" class="tab-content">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                <h2 style="color: var(--primary);">All Tasks</h2>
                <button class="btn btn-primary" onclick="openTaskModal()">+ Add Task</button>
            </div>
            <div id="tasksList" class="task-list"></div>
        </div>

        <div id="clients" class="tab-content">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <h2 style="color: var(--primary);">Clients</h2>
                <button class="btn btn-primary" onclick="openClientModal()">+ Add Client</button>
            </div>
            <div id="clientsList"></div>
        </div>

        <div id="profile" class="tab-content">
            <h2 style="color: var(--primary); margin-bottom: 20px;">Your Profile</h2>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="profileName" placeholder="Your name">
            </div>
            <div class="form-group">
                <label>Avatar</label>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <div class="avatar" style="cursor: pointer; border: 3px solid var(--border);" onclick="selectAvatar('üë§')">üë§</div>
                    <div class="avatar" style="cursor: pointer; border: 3px solid var(--border);" onclick="selectAvatar('üòä')">üòä</div>
                    <div class="avatar" style="cursor: pointer; border: 3px solid var(--border);" onclick="selectAvatar('üòé')">üòé</div>
                    <div class="avatar" style="cursor: pointer; border: 3px solid var(--border);" onclick="selectAvatar('üë®‚Äçüíº')">üë®‚Äçüíº</div>
                    <div class="avatar" style="cursor: pointer; border: 3px solid var(--border);" onclick="selectAvatar('üë©‚Äçüíº')">üë©‚Äçüíº</div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="saveProfile()">Save Profile</button>
        </div>
    </div>

    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskModalTitle">Add Task</h3>
                <button class="close-btn" onclick="closeModal('taskModal')">&times;</button>
            </div>
            <form onsubmit="saveTask(event)">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label>Task Title *</label>
                    <input type="text" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label>Client *</label>
                    <select id="taskClient" required></select>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="taskDesc" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" id="taskDate" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Time *</label>
                        <input type="time" id="taskStart" required>
                    </div>
                    <div class="form-group">
                        <label>End Time</label>
                        <input type="time" id="taskEnd">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Urgency *</label>
                        <select id="taskUrgency" required>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Reminder</label>
                        <select id="taskReminder">
                            <option value="0">None</option>
                            <option value="5">5 min</option>
                            <option value="15" selected>15 min</option>
                            <option value="30">30 min</option>
                            <option value="60">1 hour</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('taskModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="clientModalTitle">Add Client</h3>
                <button class="close-btn" onclick="closeModal('clientModal')">&times;</button>
            </div>
            <form onsubmit="saveClient(event)">
                <input type="hidden" id="clientId">
                <div class="form-group">
                    <label>Client Name *</label>
                    <input type="text" id="clientName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="clientEmail">
                </div>
                <div class="form-group">
                    <label>Color *</label>
                    <input type="color" id="clientColor" value="#4a90e2" required>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('clientModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="dayTasksModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="dayTasksTitle">Tasks</h3>
                <button class="close-btn" onclick="closeModal('dayTasksModal')">&times;</button>
            </div>
            <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="openTaskModal()">+ Add Task</button>
            <div id="dayTasksList" class="task-list"></div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let selectedDate = null;
        let tasks = [];
        let clients = [];
        let visibleClients = new Set();
        let editingTaskId = null;
        let editingClientId = null;
        let profile = { name: 'Guest', avatar: 'üë§', isGuest: true };

        function init() {
            checkFirstTime();
            loadData();
            renderCalendar();
            renderTasks();
            renderClients();
            renderClientPills();
            updateClientSelect();
            updateProfile();
            setupTabs();
        }

        function checkFirstTime() {
            if (!localStorage.getItem('visited')) {
                document.getElementById('welcomeModal').classList.add('active');
            }
        }

        function chooseMode(mode) {
            localStorage.setItem('visited', 'true');
            document.getElementById('welcomeModal').classList.remove('active');
            if (mode === 'personal') openTab('profile');
        }

        function loadData() {
            tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            clients = JSON.parse(localStorage.getItem('clients') || '[]');
            profile = JSON.parse(localStorage.getItem('profile') || '{"name":"Guest","avatar":"üë§","isGuest":true}');
            
            if (clients.length === 0) {
                clients = [
                    { id: 'c1', name: 'Personal', email: '', color: '#4a90e2' },
                    { id: 'c2', name: 'Work', email: '', color: '#e74c3c' }
                ];
                saveData();
            }
            visibleClients = new Set(clients.map(c => c.id));
        }

        function saveData() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('clients', JSON.stringify(clients));
            localStorage.setItem('profile', JSON.stringify(profile));
        }

        function setupTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => openTab(btn.dataset.tab));
            });
        }

        function openTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('monthYear').textContent = `${monthNames[month]} ${year}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDay = firstDay.getDay();
            const prevMonthDays = new Date(year, month, 0).getDate();

            let html = '';
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(d => {
                html += `<div class="cal-header">${d}</div>`;
            });

            for (let i = startDay - 1; i >= 0; i--) {
                html += `<div class="cal-day other"><div class="day-num">${prevMonthDays - i}</div></div>`;
            }

            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDate(date);
                const isToday = date.toDateString() === today.toDateString();
                const dayTasks = tasks.filter(t => t.date === dateStr && visibleClients.has(t.clientId));
                const colors = [...new Set(dayTasks.map(t => clients.find(c => c.id === t.clientId)?.color || '#999'))].slice(0, 3);

                let cls = 'cal-day';
                if (isToday) cls += ' today';
                if (dayTasks.length > 0) cls += ' has-tasks';

                html += `<div class="${cls}" onclick="selectDate('${dateStr}')">
                    <div class="day-num">${day}</div>
                    ${dayTasks.length > 0 ? `<div class="day-count">${dayTasks.length}</div>` : ''}
                    ${colors.length > 0 ? `<div class="day-dots">${colors.map(c => `<div class="dot" style="background:${c}"></div>`).join('')}</div>` : ''}
                </div>`;
            }

            const remaining = 42 - (startDay + daysInMonth);
            for (let day = 1; day <= remaining; day++) {
                html += `<div class="cal-day other"><div class="day-num">${day}</div></div>`;
            }

            document.getElementById('calendarGrid').innerHTML = html;
        }

        function changeMonth(dir) {
            if (dir === 0) currentDate = new Date();
            else currentDate.setMonth(currentDate.getMonth() + dir);
            renderCalendar();
        }

        function selectDate(dateStr) {
            selectedDate = dateStr;
            const date = new Date(dateStr + 'T00:00:00');
            document.getElementById('dayTasksTitle').textContent = `Tasks - ${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
            document.getElementById('taskDate').value = dateStr;
            
            const dayTasks = tasks.filter(t => t.date === dateStr && visibleClients.has(t.clientId));
            const container = document.getElementById('dayTasksList');
            
            if (dayTasks.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No tasks for this day</p></div>';
            } else {
                container.innerHTML = dayTasks.map(renderTask).join('');
            }
            
            document.getElementById('dayTasksModal').classList.add('active');
        }

        function renderTasks() {
            const container = document.getElementById('tasksList');
            if (tasks.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><p>No tasks yet</p></div>';
                return;
            }
            
            const sorted = [...tasks].sort((a, b) => {
                if (a.date !== b.date) return a.date.localeCompare(b.date);
                return a.startTime.localeCompare(b.startTime);
            });
            
            container.innerHTML = sorted.map(renderTask).join('');
        }

        function renderTask(task) {
            const client = clients.find(c => c.id === task.clientId);
            const urgencyColors = { low: '#27ae60', medium: '#f39c12', high: '#e67e22', urgent: '#e74c3c' };
            
            return `<div class="task-item urgency-${task.urgency}">
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <div class="task-badges">
                        <div class="badge" style="background:${client?.color || '#999'}">${client?.name || 'Unknown'}</div>
                        <div class="badge" style="background:${urgencyColors[task.urgency]}">${task.urgency}</div>
                    </div>
                </div>
                ${task.description ? `<div style="color: var(--text-light); margin: 8px 0;">${task.description}</div>` : ''}
                <div class="task-meta">
                    <span>üìÖ ${new Date(task.date + 'T00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                    <span>üïê ${formatTime(task.startTime)}</span>
                    ${task.reminder > 0 ? `<span>üîî ${task.reminder} min before</span>` : ''}
                </div>
                <div class="task-actions">
                    <button class="btn btn-primary" style="padding: 6px 12px; font-size: 0.85rem;" onclick="editTask('${task.id}')">Edit</button>
                    <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.85rem;" onclick="deleteTask('${task.id}')">Delete</button>
                </div>
            </div>`;
        }

        function renderClients() {
            const container = document.getElementById('clientsList');
            if (clients.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><p>No clients yet</p></div>';
                return;
            }
            
            container.innerHTML = clients.map(client => {
                const taskCount = tasks.filter(t => t.clientId === client.id).length;
                return `<div class="client-item">
                    <div class="client-info">
                        <div class="client-box" style="background:${client.color}">${client.name[0]}</div>
                        <div>
                            <div style="font-weight: 700;">${client.name}</div>
                            <div style="font-size: 0.85rem; color: var(--text-light);">${taskCount} task${taskCount !== 1 ? 's' : ''}</div>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn btn-primary" style="padding: 6px 12px; font-size: 0.85rem;" onclick="editClient('${client.id}')">Edit</button>
                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.85rem;" onclick="deleteClient('${client.id}')">Delete</button>
                    </div>
                </div>`;
            }).join('');
        }

        function renderClientPills() {
            const container = document.getElementById('clientPills');
            container.innerHTML = `<div class="pill ${visibleClients.size === clients.length ? 'active' : ''}" onclick="toggleClient('all')">üåê All</div>` +
                clients.map(c => `<div class="pill ${visibleClients.has(c.id) ? 'active' : ''}" onclick="toggleClient('${c.id}')">
                    <span class="dot" style="background:${c.color}"></span>${c.name}
                </div>`).join('');
        }

        function toggleClient(id) {
            if (id === 'all') {
                visibleClients = visibleClients.size === clients.length ? new Set() : new Set(clients.map(c => c.id));
            } else {
                visibleClients.has(id) ? visibleClients.delete(id) : visibleClients.add(id);
            }
            renderClientPills();
            renderCalendar();
        }

        function toggleAllClients() {
            visibleClients = visibleClients.size > 0 ? new Set() : new Set(clients.map(c => c.id));
            document.getElementById('toggleText').textContent = visibleClients.size > 0 ? 'Hide All' : 'Show All';
            renderClientPills();
            renderCalendar();
        }

        function openTaskModal() {
            editingTaskId = null;
            document.getElementById('taskModalTitle').textContent = 'Add Task';
            document.getElementById('taskId').value = '';
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDesc').value = '';
            document.getElementById('taskDate').value = selectedDate || formatDate(new Date());
            document.getElementById('taskStart').value = new Date().getHours() + 1 + ':00';
            document.getElementById('taskEnd').value = '';
            document.getElementById('taskUrgency').value = 'medium';
            document.getElementById('taskReminder').value = '15';
            document.getElementById('taskModal').classList.add('active');
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            editingTaskId = id;
            document.getElementById('taskModalTitle').textContent = 'Edit Task';
            document.getElementById('taskId').value = id;
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskClient').value = task.clientId;
            document.getElementById('taskDesc').value = task.description || '';
            document.getElementById('taskDate').value = task.date;
            document.getElementById('taskStart').value = task.startTime;
            document.getElementById('taskEnd').value = task.endTime || '';
            document.getElementById('taskUrgency').value = task.urgency;
            document.getElementById('taskReminder').value = task.reminder;
            document.getElementById('taskModal').classList.add('active');
        }

        function saveTask(e) {
            e.preventDefault();
            const task = {
                id: editingTaskId || Date.now().toString(),
                title: document.getElementById('taskTitle').value,
                clientId: document.getElementById('taskClient').value,
                description: document.getElementById('taskDesc').value,
                date: document.getElementById('taskDate').value,
                startTime: document.getElementById('taskStart').value,
                endTime: document.getElementById('taskEnd').value,
                urgency: document.getElementById('taskUrgency').value,
                reminder: parseInt(document.getElementById('taskReminder').value)
            };
            
            if (editingTaskId) {
                const index = tasks.findIndex(t => t.id === editingTaskId);
                tasks[index] = task;
            } else {
                tasks.push(task);
            }
            
            saveData();
            closeModal('taskModal');
            renderCalendar();
            renderTasks();
            
            if (selectedDate) {
                selectDate(selectedDate);
            }
        }

        function deleteTask(id) {
            if (confirm('Delete this task?')) {
                tasks = tasks.filter(t => t.id !== id);
                saveData();
                renderCalendar();
                renderTasks();
                if (selectedDate) selectDate(selectedDate);
            }
        }

        function openClientModal() {
            editingClientId = null;
            document.getElementById('clientModalTitle').textContent = 'Add Client';
            document.getElementById('clientId').value = '';
            document.getElementById('clientName').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('clientColor').value = '#' + Math.floor(Math.random()*16777215).toString(16);
            document.getElementById('clientModal').classList.add('active');
        }

        function editClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;
            
            editingClientId = id;
            document.getElementById('clientModalTitle').textContent = 'Edit Client';
            document.getElementById('clientId').value = id;
            document.getElementById('clientName').value = client.name;
            document.getElementById('clientEmail').value = client.email || '';
            document.getElementById('clientColor').value = client.color;
            document.getElementById('clientModal').classList.add('active');
        }

        function saveClient(e) {
            e.preventDefault();
            const client = {
                id: editingClientId || Date.now().toString(),
                name: document.getElementById('clientName').value,
                email: document.getElementById('clientEmail').value,
                color: document.getElementById('clientColor').value
            };
            
            if (editingClientId) {
                const index = clients.findIndex(c => c.id === editingClientId);
                clients[index] = client;
            } else {
                clients.push(client);
                visibleClients.add(client.id);
            }
            
            saveData();
            closeModal('clientModal');
            renderClients();
            renderClientPills();
            updateClientSelect();
            renderCalendar();
        }

        function deleteClient(id) {
            const taskCount = tasks.filter(t => t.clientId === id).length;
            if (taskCount > 0 && !confirm(`This client has ${taskCount} task(s). Delete anyway?`)) return;
            
            clients = clients.filter(c => c.id !== id);
            visibleClients.delete(id);
            saveData();
            renderClients();
            renderClientPills();
            updateClientSelect();
            renderCalendar();
        }

        function updateClientSelect() {
            const select = document.getElementById('taskClient');
            select.innerHTML = '<option value="">Select client</option>' + 
                clients.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        }

        function saveProfile() {
            profile.name = document.getElementById('profileName').value || 'Guest';
            profile.isGuest = false;
            saveData();
            updateProfile();
            alert('Profile saved!');
        }

        function selectAvatar(emoji) {
            profile.avatar = emoji;
            saveData();
            updateProfile();
        }

        function updateProfile() {
            document.getElementById('userName').textContent = profile.name;
            document.getElementById('avatar').textContent = profile.avatar;
            document.getElementById('profileName').value = profile.name;
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function formatTime(time) {
            const [h, m] = time.split(':');
            const hour = parseInt(h);
            return `${hour % 12 || 12}:${m} ${hour >= 12 ? 'PM' : 'AM'}`;
        }

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', e => {
                if (e.target === modal) closeModal(modal.id);
            });
        });

        init();
    </script>
</body>
</html>
